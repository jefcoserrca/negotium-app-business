<ion-header>
  <ion-toolbar color="dark">
    <ion-buttons slot="start">
      <ion-menu-button menu="main"></ion-menu-button>
    </ion-buttons>
    <ion-title>Mi código QR</ion-title>
  </ion-toolbar>
</ion-header>
<ion-content>
  <div class="container">
    <div class="conainer-fluid">
      <ion-card-title mode="ios" class="mt-4 mb-1">Código QR</ion-card-title>
      <ion-card-subtitle mode="ios">Comparte tu negocio</ion-card-subtitle>
      <div class="d-flex align-items-center justify-content-end toolsbar">
        <ion-button
          color="dark"
          fill="clear"
          shape="round"
          size="small"
          (click)="editText()"
        >
          <ion-icon slot="icon-only" name="text"></ion-icon>
        </ion-button>
        <ion-button
          color="dark"
          fill="clear"
          shape="round"
          size="small"
          class="ms-2"
          (click)="formatColor()"
        >
          <ion-icon slot="icon-only" name="color-palette"></ion-icon>
        </ion-button>
        <ion-button
          color="dark"
          fill="clear"
          shape="round"
          size="small"
          class="ms-2"
          (click)="setType()"
        >
          <ion-icon
            slot="icon-only"
            [src]="'../../../assets/icons/'+qrCodeFormat?.type+'.svg'"
          ></ion-icon>
        </ion-button>
      </div>
      <div id="qr-code" class="d-flex justify-content-center">
        <div class="mt-3" *ngIf="qrCodeFormat.type === 'full-bottom'">
          <ion-card
            [ngStyle]="{'background': qrCodeFormat.styles.bgColor, 'color': qrCodeFormat.styles.txtColor}"
          >
            <div class="p-3">
              <div class="qr-content">
                <ngx-qrcode
                  [elementType]="'url'"
                  [value]="qrCodeFormat.link"
                  errorCorrectionLevel="H"
                >
                </ngx-qrcode>
              </div>
            </div>
            <ion-card-content>
              <div class="d-flex justify-content align-items-center pb-2">
                <ion-avatar slot="start">
                  <img [src]="storeData?.picture" />
                </ion-avatar>
                <h2 class="ms-3">{{ storeData?.name }}</h2>
              </div>
              <p class="text-center">{{ qrCodeFormat.text }}</p>
            </ion-card-content>
          </ion-card>
        </div>
        <div class="mt-5" *ngIf="qrCodeFormat.type === 'logo-only'">
          <div class="logo-card">
            <img
              [ngStyle]="{'background': qrCodeFormat.styles.bgColor}"
              [src]="storeData?.picture"
              alt=""
            />
            <ion-card
              [ngStyle]="{'background': qrCodeFormat.styles.bgColor, 'color': qrCodeFormat.styles.txtColor}"
            >
              <div class="p-3">
                <div class="qr-content">
                  <ngx-qrcode
                    [elementType]="'url'"
                    [value]="qrCodeFormat.link"
                    errorCorrectionLevel="H"
                  >
                  </ngx-qrcode>
                </div>
              </div>
              <ion-card-content>
                <p class="text-center">{{ qrCodeFormat.text }}</p>
              </ion-card-content>
            </ion-card>
          </div>
        </div>
        <div class="mt-3" *ngIf="qrCodeFormat.type === 'full-top'">
          <ion-card
            [ngStyle]="{'background': qrCodeFormat.styles.bgColor, 'color': qrCodeFormat.styles.txtColor}"
          >
            <ion-card-content class="p-0">
              <div class="d-flex justify-content align-items-center p-3">
                <ion-avatar slot="start">
                  <img [src]="storeData?.picture" />
                </ion-avatar>
                <h2 class="ms-3">{{ storeData?.name }}</h2>
              </div>
            </ion-card-content>
            <div class="p-3">
              <div class="qr-content">
                <ngx-qrcode
                  [elementType]="'url'"
                  [value]="qrCodeFormat.link"
                  errorCorrectionLevel="H"
                >
                </ngx-qrcode>
              </div>
            </div>
            <ion-card-content class="pt-0">
              <p class="text-center mt-0">{{ qrCodeFormat.text }}</p>
            </ion-card-content>
          </ion-card>
        </div>
        <div class="mt-3" *ngIf="qrCodeFormat.type === 'text-only'">
          <ion-card
            [ngStyle]="{'background': qrCodeFormat.styles.bgColor, 'color': qrCodeFormat.styles.txtColor}"
          >
            <div class="p-3">
              <div class="qr-content">
                <ngx-qrcode
                  [elementType]="'url'"
                  [value]="qrCodeFormat.link"
                  errorCorrectionLevel="H"
                >
                </ngx-qrcode>
              </div>
            </div>
            <ion-card-content class="pt-0">
              <p class="text-center mt-0">{{ qrCodeFormat.text }}</p>
            </ion-card-content>
          </ion-card>
        </div>
        <div class="mt-3" *ngIf="qrCodeFormat.type === 'code-only'">
          <ion-card
            [ngStyle]="{'background': qrCodeFormat.styles.bgColor, 'color': qrCodeFormat.styles.txtColor}"
          >
            <div class="p-3">
              <div class="qr-content">
                <ngx-qrcode
                  [elementType]="'url'"
                  [value]="qrCodeFormat.link"
                  errorCorrectionLevel="H"
                >
                </ngx-qrcode>
              </div>
            </div>
          </ion-card>
        </div>
      </div>
      <div class="d-flex align-items-center justify-content-center mt-3">
        <ion-button
          color="tertiary"
          [matMenuTriggerFor]="menuDownloads"
          class="me-3"
          (click)="setItem(null)"
        >
          <ion-icon slot="start" name="download"></ion-icon>
          Descargar
        </ion-button>
      </div>
      <br />

      <ion-card-subtitle mode="ios" class="mt-3 mb-1"
        >Comparte tus redes sociales</ion-card-subtitle
      >
      <div class="d-flex flex-nowrap m-2 one-row">
        <div *ngFor="let item of contactData" class="social-card">
          <div
            class="
              d-flex
              align-items-center
              justify-content-end
              toolsbar
              w-100
              me-4
            "
          >
            <ion-button
              color="dark"
              fill="clear"
              shape="round"
              size="small"
              (click)="editTextSocialQr(item)"
            >
              <ion-icon slot="icon-only" name="text"></ion-icon>
            </ion-button>
            <ion-button
              color="dark"
              fill="clear"
              shape="round"
              size="small"
              class="ms-2"
              (click)="addContactLink(item)"
            >
              <ion-icon slot="icon-only" name="link"></ion-icon>
            </ion-button>
          </div>
          <div class="p-3" [id]="item.name">
            <ion-card
              class="m-0"
              [ngClass]="{'whatsapp': item.name === 'whatsapp', 'facebook': item.name === 'facebook', 'instagram': item.name === 'instagram', 'phone': item.name === 'phone', 'no-visible': !item.show}"
            >
              <div class="d-flex align-items-center header-card w-100">
                <img
                  [src]="'../../../assets/icons/'+item.icon+'.svg'"
                  alt="icon"
                />
                <span class="ms-3 W-100">{{ item.label | titlecase }}</span>
              </div>
              <div class="p-3">
                <div class="qr-content">
                  <ngx-qrcode
                    [elementType]="'url'"
                    [value]="item.path ? item.path+item.link : item.link"
                    errorCorrectionLevel="H"
                  >
                  </ngx-qrcode>
                </div>
              </div>
            </ion-card>
          </div>
          <div class="mb-2">
            <ion-button
              color="tertiary"
              [matMenuTriggerFor]="menuDownloads"
              class="me-3"
              (click)="setItem(item.name)"
              [disabled]="!item.show"
            >
              <ion-icon slot="start" name="download"></ion-icon>
              Descargar
            </ion-button>
          </div>
        </div>
        <div *ngIf="!contactData.length" class="w-100 mt-4">
          <app-message-embedded
            [title]="'No hay links de contacto'"
            [message]="'Completa la información de tu negocio en Menú > Mi tienda online > Contacto'"
            [buttonPath]="'/dashboard/store'"
            [buttonText]="'Ir ahora'"
          ></app-message-embedded>
        </div>
      </div>
    </div>
  </div>
  <br />
</ion-content>
<ion-footer>
  <ion-toolbar color="dark">
    <ion-buttons slot="end">
      <ion-button (click)="saveFormat()" color="primary">
        <ion-icon slot="start" name="save"></ion-icon>
        Guardar
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-footer>
<mat-menu #menuDownloads="matMenu">
  <div class="m-3">
    <h5>Tipo de archivo</h5>
    <p>Selecciona la extensión del archivo</p>
  </div>
  <ion-list lines="none">
    <ion-item button (click)="downloadPng()">
      <ion-label>archivo .PNG</ion-label>
    </ion-item>
    <ion-item button (click)="downloadSvg()">
      <ion-label>archivo .SVG</ion-label>
    </ion-item>
  </ion-list>
</mat-menu>

<mat-menu #menuLinks="matMenu">
  <div class="m-3">
    <h5>Código QR</h5>
    <p>Añade o edita un link de contacto para QR</p>
  </div>
  <ion-list lines="none">
    <ion-item
      *ngFor="let item of contactData"
      button
      (click)="addContactLink(item)"
    >
      <ion-icon slot="start" [name]="item.icon"></ion-icon>
      <ion-label>{{item.name | titlecase}}</ion-label>
    </ion-item>
  </ion-list>
</mat-menu>
